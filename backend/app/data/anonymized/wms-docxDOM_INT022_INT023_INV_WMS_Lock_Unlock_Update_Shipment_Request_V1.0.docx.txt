**Table:**

| Business / Technical Brief |
| [Anonymized Customer]-INT022 & INT023 – INV WMS Lock Unlock and Update Shipment Request from Fusion to WMS 10th Jun 2024, Version  Copyright © 2024, Oracle and/or its affiliates |

---

# Document Control

## Change History

---
**Table:**

| Date | Author | Version | Description |
| 10-Jun-2024 | Iqbal Singh | 1a | Initial Version |
| 20-Jun-2024 | Akanksha Sachan | 1b | Technical specifications added to initial version |
|  |  |  |  |
|  |  |  |  |

---

## Reviewed By

---
**Table:**

| Date | reviewer | role |
| 24-Jun-2024 | Rakesh Mishra | Technical Lead |
| 17-Jun-2024 | Amit | WMS Lead |
|  |  |  |
|  |  |  |

---

# Introduction

## Purpose

The objective of this document is to provide a Design Specification to:
Provide the necessary information with enough detail so that the Project team, have a clear understanding of the design and functional requirements.

## Scope

This document specifies the business context, functional requirements, and details to integrate Oracle Fusion to Oracle Cloud WMS for Sales Order change management process.
A warehouse management system (or WMS) is a software application designed to support warehouse or distribution center management and staff. They facilitate management of available resources to move and store materials into, within, and out of a warehouse, while supporting staff in material movement and storage.
Coordinating the communication with these systems to support purchase order receipts, returns to vendors, internal material transfers, inventory transactions, and sales order shipments is a substantial integration effort.
Inventory Management Cloud supports a central integration framework across Oracle Procurement Cloud, Oracle Order Management Cloud, and Oracle Inventory Management based on web services to support the interactions between WMS and Fusion Cloud.
Using these services, Inventory Management Cloud communicates Sales Order changes to Oracle Cloud WMS for processing.

## Functional Overview

[Anonymized Customer] business process flow requires the Change Order to be initiated in Order Management system to facilitate the amendments to the sales order and then the corresponding changes should be performed in WMS system. Once change order is initiated, the integration will first check if the shipment line is already interfaced to WMS or not. If it’s already interfaced, following steps would be executed via integration:
- Lock the corresponding sales order WMS via integration.
- Perform the changes to the sales order in Fusion.
- Perform corresponding changes to sales order in WMS via integration.
- Unlock the corresponding sales order in WMS via integration.
If the shipment line is not already interfaced, the integration will skip the shipment line for processing.

# Business Objectives

When integrating Oracle Inventory Management Cloud with a warehouse management system (or WMS), there is the requirement to send the sales order changes in Fusion to WMS so that corresponding changes can be performed in WMS system.
Business Flow:
The above picture depicts the process flow as per business requirement. The steps initiate in Fusion Order Management with the creation of the sales order in Fusion order management. This shipment line is interfaced to WMS via shipment request job and corresponding sales order is created in WMS. Based on business need, sales order cancellation/update is initiated in Fusion. The corresponding transaction in WMS is validated if it’s not allocated or picked. If it’s not allocated or picked in WMS, then the corresponding sales order line in fusion is locked. As part of synchronous interface from Fusion to WMS, number lock is applied to corresponding line in WMS. Then the fusion order line is updated. Once changes are completed in Fusion, the corresponding WMS line is updated via synchronous interface from Fusion to WMS. Thereafter, order line in fusion is unlocked. This will trigger unlock operation in WMS line via synchronous integration. This will complete the change order process.

## Process Overview

- Initiate change order process in Fusion Order Management.
- Validate the sales order in WMS if it’s not allocated or picked.
- Apply lock to the fusion order.
- Apply lock to the corresponding WMS order via integration (INT023)
- Perform changes to sales order in Fusion.
- Perform changes (updates) to order in WMS via integration (INT022)
- Unlock order in Fusion.
- Unlock order in WMS via integration (INT023)

# Pre-Conditions

- Shipment line should be interfaced from Fusion to WMS
- Line in WMS should not be allocated or picked.

# Risk Matrix

---
**Table:**

| Risk | Impact  (1 to 5) | Probability (1 to 5) | Mitigation |
|  |  |  |  |
|  |  |  |  |
|  |  |  |  |
|  |  |  |  |
|  |  |  |  |
|  |  |  |  |
|  |  |  |  |

---

# Other Integrations Design Dependency

---
**Table:**

| Name | Dependency | comments |
| Sales order creation to WMS |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |

---

# Frequency

---
**Table:**

| Event | Frequency | Data volume |
| Event Based | As per transaction changes |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |

---

# Open Items

This section is used to summarize any open items related to the design.

---
**Table:**

| No. | open item | data required | status | impact if not closed |
| 001 |  |  |  |  |
| 002 |  |  |  |  |
| 003 |  |  |  |  |
| 004 |  |  |  |  |
| 005 |  |  |  |  |
| 006 |  |  |  |  |
| 007 |  |  |  |  |

---

# Business Use Case:

- Create Sales Order in Fusion and send to WMS.
- Modify sales order line in Fusion to enable corresponding changes in WMS.
- Cancel sales order line in Fusion to enable corresponding cancellation in WMS.

# Technical Overview

### Scope

The objective of this document is to provide [Anonymized Customer] with a Technical Specification for Outbound Integration for Publishing Items from Fusion to WMS.

### Glossary

---
**Table:**

| Annotation | Definition |
| ERP | Enterprise Resource Planning |
| SCM | Supply Chain Management |
| OIC | Oracle integration cloud |
| API | Application Programming Interface |
| SaaS | Software as a service |
| PaaS | Platform as a Service |
| OM | Order Management |
| WMS | Warehouse Management System |

---

### Document References

---
**Table:**

| Ref No | Name | File location |
| 1 |  |  |
| 2 |  |  |
| 3 |  |  |

---

### Sample Data & Mapping Template

---
**Table:**

| Description | File |
| Data Mapping LOCK UNLOCK Template for Fusion to WMS |  |
| Data Mapping UPDATE Template for Fusion to WMS |  |
| Sample WMS LOCK UNLOCK Response XML Payload |  |
| Sample WMS UPDATE Response XML Payload |  |

---

### Frequency

---
**Table:**

| Responsiveness | Frequency | Volume |
| Batch | Planned as daily with Ad Hoc option | Depends on the Sales order updated in the last 24 hours by users |

---

### Assumptions

- Mapping between Inventory Organizations in ERP and WMS Facilities needs to be setup for this integration to extract data.
- The integrations will get triggered when update action is performed in order management for any sales order.
- In case of any success/error in the integration, a notification email will be sent to the mail list configured in the OIC lookup.

### High Level Approach

- The integration will trigger once the update action is performed in order management for any sales order.
- The payload received from ERP will contain the sales order details.
- When any sales order is updated in OM, lock will be applied to sales order in WMS, sales order will be updated in WMS, then sales order will be unlocked in WMS.
- The integration will be real time integration.

### Pre-Requisites

Send email and SMS integration “XxCommonNotificationHandler” should be deployed in the OIC.
Integration “XxLockUnlockShipmentRequestInvToWms”, “XxUpdateShipmentRequestInvToWms” should be deployed in the OIC.
Lookup “XXDominoCommonLookup” should be present with all the required details regarding success/error email notify flag, success and error notify ToEmail Address in OIC.
Lookup “XxDominoConstantLookup” should be present with all the required details regarding success and error notify FromEmail Address in OIC.
Lookup “XXDominoWmsCompanyLookup” should be present with all the required details.
Lookup “XxDominoWmsOrderTypeLookUp” should be present with all the required details.
BIP Report should be present in the path mentioned in XXDominoCommonLookup.

# Integration Analysis – XxLockUnlockShipmentRequestInvToWms/ XxUpdateShipmentRequestInvToWms

This Integration component is responsible for locking and unlocking of sales orders in WMS system.

### Integration Components

Below are the required components for this integration.

---
**Table:**

| Integration Name | Integration Pattern | Package Name | Lookup Name |
| XxLockUnlockShipmentRequestInvToWms | App Driven Orchestration |  | XXDominoCommonLookup, XxDominoConstantLookup |
| XxUpdateShipmentRequestInvToWms | App Driven Orchestration |  | XXDominoCommonLookup, XxDominoConstantLookup, XxDominoWmsOrderTypeLookUp, XxDominoWmsOrderTypeLookUp |

---

### Required Connections

---
**Table:**

| Connection Name | Connection Type | Connection Role |
| XxLockUnlockShipmentRequestConnection | Oracle SOAP Connection | Trigger and invoke |
| XxDominoWMSConnection | Oracle WMS Cloud | Trigger and invoke |
| XxOicRestTrigger | Oracle REST | Trigger |
| XxDominoBIReportConnection_WMSINT | Oracle SOAP | Invoke |
| XxAtpDb | Oracle ATP | Trigger and invoke |

---

### Integration Outline

Figure 1: Architecture Diagram
The Following section explains the step – by- step process of locking/unlocking and updating shipment requests.
- Integration – XxLockUnlockShipmentRequestInvToWms
- ValidateAndLockRequest: This is a SOAP connection to trigger ValidateAndLock operation for a shipment.
When a revision of sales order is created in fusion, lock gets applied to sales order in Fusion Order Management and Fusion INV and sales order in WMS need to be locked when updates are taking place.
- AssignGlobalVariables: The Global variable will be the Integration code which will be fetched from maintained lookup – “XXDominoCommonLookup”.

---
**Table:**

| Variable name | Data type | Value |
| InterationCode | String | dvm:lookupValue('XXDominoCommonLookup', 'IntegrationCode', XXLOCKUNLOCKSHIPMENTREQINVTOWMS, 'IntegrationCode', '') IntegrationCode will be fetched from OIC lookup “XXDominoCommonLookup”, with reference to this lookup all other local variables will be fetched. |

---

- AssignLocalVariables:

---
**Table:**

| Variable name | Data type | Value |
| IntegrationID | String | dvm:lookupValue('XXDominoCommonLookup', 'IntegrationCode', $IntegrationCode, 'RiceID', '') |
| EmailFrom | String | dvm:lookupValue('XxDominoConstantLookup', 'ID', 'FromEmailId', 'Value', '') |
| v_deliveryid | String | ‘’ |
| v_externally_planned_load_nbr | String | ‘’ |
| SucessNotifyEmail | String | dvm:lookupValue('XXDominoCommonLookup', 'IntegrationCode', $IntegrationCode, 'SuccessNotify', '') |

---

- Scope: LockUnlockShipment
- GetOrchestrationDetails: This is an Oracle BI report connection which is being used to call BI report to fetch order details.
Map Activity GetOrchestrationDetails: In this step, report path and order         number would be mapped to fetch sales orders details.
- AssignReportData: In this step, report data fetched in previous step is being assigned to a local variable called Decode_Report as below:

---
**Table:**

| Variable name | Data type | Value |
| Decode_Report | String | oraext:decodeBase64ToReference($GetOrchestrationDetails/tns:runReportResponse/tns:runReportReturn/tns:reportBytes) |

---

- ReadReportData: Stage Read operation is being performed in BI report data assigned into variable Decode_Report in previous step.
- StagePayload: In this step, New Order number is being generated as per SHIPSET LOGIC.
Map Activity StagePayload: In this step, payload fields are being mapped as     per SHIPSET LOGIC.
- readPayload: Performing stage read operation over the payload written in previous step.
- Switch: This object will work as IF/else which will route the integration operation path based on the conditions assigned to it.
- If “ActionType” = “LOCK” OR “APPLY_HOLD”
- ValidateAndLockAPICall: This step will use below REST based API to lock sales order in WMS:
/wms/lgfapi/v10/entity/order_hdr/bulk_lock
Map Activity: In the map activity, WMS Data fields are mapped with the INV fields.
- SuccessNotify: Once the data is posted into WMS side with success response and all the operations in Integration are completed normal then success email notification will be sent to respective team through “XxCommonNotificationHandler(1.0.1)”.
With map activity, process will map the below values to common error handler Integration.

---
**Table:**

| Request Parameters | Values |
| IntegrationCode | $IntegrationCode |
| IntegrationID | $IntegationID |
| InstanceID | $self/nsmpr2:metadata/nsmpr2:runtime/nsmpr2:instanceId |
| ErrorCode |  |
| ErrMsg |  |
| EmailFrom | $EmailFrom |
| SucessNotifyEmail | $SucessNotifyEmail |
| EmailSub | concat ("dvm:lookupValue('XxDominoConstantLookup', 'ID', 'InstanceName', 'Value', '')", " - ", "SUCCESS", " - ", dvm:lookupValue ("XXDominoCommonLookup", "IntegrationCode", $InterationCode, "IntegrationDesc", "" ), " - ", $self/nsmpr2:metadata/nsmpr2:runtime/nsmpr2:instanceId ) |
| Logging | Y |

---

- If “ActionType”= “RELEASELOCK” OR “RELEASE_HOLD”
- ValidateAndLockAPICall: This step will use below REST based API to unlock sales order in WMS:
/wms/lgfapi/v10/entity/order_hdr/bulk_unlock
Map Activity: In the map activity, WMS Data fields are mapped with the INV fields.
- Generate DeliveryId
ForEachShipmentLine
- GetOrderHeaderDetails: This step will call the WMS common api- “/wms/lgfapi/v10/entity/order_hdr” which is responsible to get order header details from WMS system. There is one query parameter added for this API to send the request as below.
Query Parameters-
- order_nbr- mapping it to new order number generated as per Shipset Logic.
The request will be sent to WMS API as – Send query parameters   as form data in message body.
- GetOrderLineDetails: This step will call the WMS common api- “/wms/lgfapi/v10/entity/order_dtl” which is responsible to get order line details from WMS system. There are below query parameters added for this API to send the request as below.
Query Parameters-
- order_id- mapping it to order Id from response of GetOrderHeaderDetails API.
- ship_request_line- mapping it with ShipmentLine from fusion payload.
The request will be sent to WMS API as – Send query parameters as form data in message body.
- GetShipViaDetails: This step will call the WMS common api- “/wms/lgfapi/v10/entity/ship_via” which is responsible to get order ship via details from WMS system. There is one query parameter added for this API to send the request as below.
Query Parameters-
- id- mapping it with ship via id from GetOrderHeaderDetails API response.
The request will be sent to WMS API as – Send query parameters   as form data in message body.
- AssignDeliveryId: Generating Delivery Id in this step.

---
**Table:**

| Variable name | Data type | Value |
| v_deliveryid | String | fn:concat($GetOrderHeaderDetails/ns25:executeResponse/ns29:response